<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>H40N - N.ROOT | TERMINAL V3.3</title>
<style>
    :root{
        --bg:#0a0a0a;
        --panel:#111;
        --panel-2:#1a1a1a;
        --text:#e5e5e5;
        --muted:#9aa4ac;
        --accent:#4ecbff;
        --prompt:#00e676;
        --user:#6ac8ff;
        --admin:#e5e5e5;
    }
    html,body{
        height:100%;
        margin:0;
        background:var(--bg);
        font-family:monospace;
        color:var(--text);
    }
    .terminal-wrapper{
        width:92%;
        max-width:980px;
        margin:28px auto;
        border-radius:10px;
        overflow:hidden;
        border:1px solid #222;
        box-shadow:0 10px 50px rgba(0,0,0,0.7);
        background:linear-gradient(180deg,var(--panel),#0f0f0f);
    }
    .terminal-header{
        display:flex;
        align-items:center;
        gap:10px;
        padding:12px;
        background:var(--panel-2);
        border-bottom:1px solid #222
    }
    .dot{
        width:12px;
        height:12px;
        border-radius:50%
    }
    .red{background:#ff5f56}
    .yellow{background:#ffbd2e}
    .green{background:#27c93f}
    
    .terminal-title{
        flex:1;
        text-align:center;
        opacity:.85;
        font-size:0.95rem
    }
    #output{
        height:68vh;
        padding:20px;
        overflow-y:auto;
        white-space:pre-wrap;
        line-height:1.35;
        font-size:0.98rem
    }
    .terminal-input-area{
        display:flex;
        align-items:center;
        gap:10px;
        padding:12px;
        background:var(--panel-2);
        border-top:1px solid #222
    }
    #prompt{color:var(--prompt);font-weight:700}
    /* fake input box (disabled) */
    .input-disabled{
        flex:1;
        padding:10px 12px;
        border-radius:6px;
        border:1px dashed #2b2b2b;
        background:transparent;
        color:var(--muted);
        font-family:monospace;
        font-size:0.95rem;
    }
    .note-strong{color:#ff9aa2;font-weight:700}
    .line{margin:6px 0}
    .meta{color:var(--muted)}
    .user-NOAH{color:#3ee9e9}
    .user-ECH0{color:#ffa200}
    .admin-msg{color:var(--admin)}
    .process{color:#ffdb25}
    .sucess{color:#00e676}

    /* typing caret for lines being typed */
    .typing-caret::after{
        content: "|";
        display:inline-block;
        margin-left:6px;
        animation: blink 1s steps(2,start) infinite;
        color:var(--text);
    }
    @keyframes blink{50%{opacity:0}}
    /* small emphasis */
    .em{color:var(--accent)}
    /* scrollbar cosmetic */
    #output::-webkit-scrollbar{width:10px}
    #output::-webkit-scrollbar-thumb{background:#111;border-radius:6px}

    .gap {
    height: 22px;     /* tamanho visual do salto */
    display: block;
    }

    .progress-bar-container {
    width: 100%;
    background: #111;
    border: 1px solid #222;
    border-radius: 6px;
    margin-top: 8px;
    padding: 6px;
    }

    .progress-label {
    margin-top: 4px;
    font-size: 0.85rem;
    color: var(--muted);
    }

    /* anima√ß√£o de "processando" na barra fixa */
    .progress-bar {
        height: 14px;
        width: 0%;
        background: var(--accent);
        border-radius: 4px;
        transition: width 1.6s ease;
        position: relative;
        overflow: hidden;
    }

    /* efeito de brilho se movendo dentro da barra */
    .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: -40%;
        width: 40%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255,255,255,0.35),
            transparent
        );
        animation: barShine 1.4s infinite linear;
        mix-blend-mode: screen;
    }

    @keyframes barShine {
        0% { left: -40%; }
        100% { left: 140%; }
    }

    .fade-out {
    opacity: 0;
    transition: opacity 0.45s ease;
    }

    /* video */
    .video-overlay {
    position: absolute;
    inset: 60px 40px 100px 40px;
    background: linear-gradient(180deg, #111, #0c0c0c);
    border: 1px solid #222;
    border-radius: 10px;
    box-shadow: 0 15px 40px rgba(0,0,0,.85);
    display: flex;
    flex-direction: column;
    z-index: 60;
    overflow: hidden;
}

/* header da janela de v√≠deo */
.video-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: #1a1a1a;
    border-bottom: 1px solid #222;
}

.video-title {
    flex: 1;
    text-align: center;
    font-size: 0.85rem;
    opacity: 0.8;
}

/* √°rea do v√≠deo */
.video-body {
    flex: 1;
    position: relative;
}

.video-body video {
    width: 100%;
    height: 100%;
    object-fit: cover; /* üî• sem sobras */
    display: block;
}
/*audio*/
.audio-player {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 14px 0;
    padding: 10px 14px;
    border: 1px solid #222;
    border-radius: 8px;
    background: linear-gradient(180deg, #111, #0c0c0c);
    cursor: pointer;
    user-select: none;
}

.audio-player:hover {
    border-color: var(--accent);
}

.audio-icon {
    width: 0;
    height: 0;
    border-left: 12px solid var(--accent);
    border-top: 7px solid transparent;
    border-bottom: 7px solid transparent;
}

.audio-player.active .audio-icon {
    border-left-color: var(--prompt);
}

.audio-label {
    font-size: 0.85rem;
    color: var(--muted);
}

.audio-player.active .audio-label {
    color: var(--prompt);
}




</style>
</head>
<body>
<div class="terminal-wrapper" role="region" aria-label="Contingency Terminal">
    <div class="terminal-header">
        <div class="dot red"></div>
        <div class="dot yellow"></div>
        <div class="dot green"></div>
        <div class="terminal-title">H40N - N.ROOT | TERMINAL V3.3</div>
    </div>

    <div id="output" aria-live="polite"></div>

    <div class="terminal-input-area" aria-hidden="true">
        <div id="prompt">&gt;</div>
        <!-- √°rea onde usu√°rio podia digitar: permiss√£o removida -->
        <div class="input-disabled" title="Escrita desativada">
            &nbsp;N√£o √© poss√≠vel inserir comandos agora.
        </div>
    </div>
</div>

<script>
const output = document.getElementById("output");


let audioUnlocked = false;
let audioPlayerShown = false;
let globalAudio = null;


/* =========================
   UTILIDADES DE TEXTO
========================= */
function appendLine(cls = "") {
    const el = document.createElement("div");
    el.className = "line " + cls;
    output.appendChild(el);
    output.scrollTop = output.scrollHeight;
    return el;
}
/*audio*/
function playAudio(src) {
    if (!audioUnlocked) return;

    if (globalAudio) {
        globalAudio.pause();
        globalAudio.currentTime = 0;
    }

    globalAudio = new Audio(src);
    globalAudio.volume = 1;
    globalAudio.play().catch(() => {});
}
/*audio*/


function typeLine(el, text) {
    return new Promise(resolve => {
        let i = 0;
        function step() {
            el.textContent += text[i] || "";
            i++;
            if (i < text.length) {
                setTimeout(step, 15 + Math.random() * 25);
            } else resolve();
        }
        step();
    });
}

async function eraseBlock(lines) {
    for (let el of lines.reverse()) {
        el.classList.add("fade-out");
        await new Promise(r => setTimeout(r, 450));
        el.remove();
    }
}

/* =========================
   BARRA DE RECRIA√á√ÉO
========================= */
let recreationBar = null;
let recreationValue = 0;
let stallInterval = null;

function startRecreationBar() {
    recreationBar = document.createElement("div");
    recreationBar.className = "progress-bar-container";

    const bar = document.createElement("div");
    bar.className = "progress-bar";
    bar.style.width = "80%"; // üîí trava direto em 80%

    const label = document.createElement("div");
    label.className = "progress-label";
    label.textContent = "Carregamento do terminal em 80%";

    recreationBar.appendChild(bar);
    recreationBar.appendChild(label);
    output.appendChild(recreationBar);

    // inicia apenas o texto falso de carregamento
    startStallText(label);
    setTimeout(() => {
        startRecreationSequence();
    }, 1000);
}

function startStallText(label) {
    const msgs = [
        "carregando grafos",
        "resolvendo depend√™ncias",
        "indexando mem√≥ria",
        "validando estruturas"
    ];
    let i = 0, dots = 0;

    stallInterval = setInterval(() => {
        dots = (dots + 1) % 4;
        label.textContent =
            `Carregamento do terminal em 80% ‚Äî ${msgs[i]}${".".repeat(dots)}`;
        if (Math.random() > 0.6) i = (i + 1) % msgs.length;
    }, 700);
}

/* =========================
   SEQU√äNCIA NARRATIVA
========================= */
async function startRecreationSequence() {
    await new Promise(r => setTimeout(r, 2500));

    const blocks = [
        [
            ["[H40N] talvez voc√™ esteja certo", "user-NOAH"],
            ["[H40N] talvez... ningu√©m esteja vindo", "user-NOAH"],
            ["[H40N] para onde viriam? nem eu sei mais onde estou", "user-NOAH"],
        ],
        [
            ["[ECH0] voc√™ entende agora?", "user-ECH0"],
            ["[ECH0] lutar √© inutil", "user-ECH0"],
            ["[H40N] sim, eu s√≥ n√£o entendia ainda", "user-NOAH"],
        ],
        [
            ["[ECH0] 3:33 o meu momento preferido daquela noite", "user-ECH0"],
        ],
    ];

    for (let i = 0; i < blocks.length; i++) {
    let els = [];

    for (let [text, cls] of blocks[i]) {
    const el = appendLine(cls);
    els.push(el);
    await typeLine(el, text);

    if (text === "[H40N] 3:33 o momento exato que tudo mudou") {
    appendAudioPlayer();}
    }


    // üé• dispara o v√≠deo logo ap√≥s o primeiro bloco terminar de escrever
    if (i === 0) {
        await playVideoThenAudio("assets/033.mp4");
    }

    await new Promise(r => setTimeout(r, 3000));
    await eraseBlock(els);

    }
}

function appendAudioPlayer() {
    if (audioPlayerShown) return;
    audioPlayerShown = true;

    const wrapper = document.createElement("div");
    wrapper.className = "audio-player";

    const icon = document.createElement("div");
    icon.className = "audio-icon";

    const label = document.createElement("div");
    label.className = "audio-label";
    label.textContent = "ativar canal sonoro";

    wrapper.appendChild(icon);
    wrapper.appendChild(label);
    output.appendChild(wrapper);
    output.scrollTop = output.scrollHeight;

    wrapper.addEventListener("click", () => {
        if (audioUnlocked) return;

        audioUnlocked = true;
        wrapper.classList.add("active");
        label.textContent = "√°udio sincronizado";

        playAudio("assets/artefato.mp3");
    });
}



function playVideoThenAudio(videoSrc, audioSrc) {
    return new Promise(resolve => {

        const overlay = document.createElement("div");
        overlay.className = "video-overlay";

        const header = document.createElement("div");
        header.className = "video-header";

        header.innerHTML = `
            <div class="dot red"></div>
            <div class="dot yellow"></div>
            <div class="dot green"></div>
            <div class="video-title">MEMORY STREAM</div>
        `;

        const body = document.createElement("div");
        body.className = "video-body";

        const video = document.createElement("video");
        video.src = videoSrc;
        video.autoplay = true;
        video.muted = true;        // autoplay permitido
        video.playsInline = true;
        video.controls = false;

        body.appendChild(video);
        overlay.appendChild(header);
        overlay.appendChild(body);

        document.querySelector(".terminal-wrapper").appendChild(overlay);

        video.onended = () => {
            overlay.remove();

            if (audioSrc) {
                const audio = new Audio(audioSrc);
                audio.play();
                audio.onended = () => resolve();
            } else {
                resolve();
            }
        };
    });
}

/* =========================
   IN√çCIO
========================= */
async function start() {
    const el = appendLine("meta");
    await typeLine(el, "RECOVERY MODE");
    await new Promise(r => setTimeout(r, 800));

    await new Promise(r => setTimeout(r, 1200));
    startRecreationBar();
}

setTimeout(start, 500);
</script>

</body>
</html>
